-# The main body of the page
- content_for :main do
  -# Is this the first time the user has seen this page? (no parts and the created_at/updated_at times are identical)
  - if logged_in? && @page.parts.length > 0 && @page.created_at == @page.updated_at
    %p.blank 
      Welcome to your site! To start making it your own just click the <strong>Edit</strong> button next to the text you want to change and then click <strong>Save</strong> when you're done! Check out the 
      =link_to_function 'Help', "dovetail.showAdmin('help')"
      section for some tutorials!
  #parts
    - if @page.parts.empty?
      %p.blank
        Here is your new
        %strong= "#{@page.name}"
        page. But, there's nothing here yet! Add a
        = link_to_function('page part', "$(this).up().hide(); $('add_part_link').hide(); $('new_part').show()")
        to this page to get some text, photos or other content here.
    - else
      - @page.parts.each do |part|
        = render :partial => "parts/#{part.part_type.class_name}", :locals => { :part => part, :mode => :view }
      = textile_editor_initialize
      
  = render :partial => 'add_part', :locals => { :page => @page }